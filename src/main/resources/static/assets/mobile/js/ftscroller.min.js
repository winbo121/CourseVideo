/**
 * FTScroller: touch and mouse-based scrolling for DOM elements larger than their containers.
**/
var FTScroller,CubicBezier;(function(){'use strict';var _vendorCSSPrefix,_vendorStylePropertyPrefix,_vendorTransformLookup,_pointerEventsPrefixed,_setPointerCapture,_releasePointerCapture,_lostPointerCapture,_trackPointerEvents,_pointerTypeTouch;if(document.createElement('div').style.transform!==undefined){_vendorCSSPrefix='';_vendorStylePropertyPrefix='';_vendorTransformLookup='transform'}else if(window.opera&&Object.prototype.toString.call(window.opera)==='[object Opera]'){_vendorCSSPrefix='-o-';_vendorStylePropertyPrefix='O';_vendorTransformLookup='OTransform'}else if(document.documentElement.style.MozTransform!==undefined){_vendorCSSPrefix='-moz-';_vendorStylePropertyPrefix='Moz';_vendorTransformLookup='MozTransform'}else if(document.documentElement.style.webkitTransform!==undefined){_vendorCSSPrefix='-webkit-';_vendorStylePropertyPrefix='webkit';_vendorTransformLookup='-webkit-transform'}else if(typeof navigator.cpuClass==='string'){_vendorCSSPrefix='-ms-';_vendorStylePropertyPrefix='ms';_vendorTransformLookup='-ms-transform'}if('pointerEnabled'in window.navigator){_pointerEventsPrefixed=false;_trackPointerEvents=window.navigator.pointerEnabled;_setPointerCapture='setPointerCapture';_releasePointerCapture='releasePointerCapture';_lostPointerCapture='lostpointercapture';_pointerTypeTouch='touch'}else if('msPointerEnabled'in window.navigator){_pointerEventsPrefixed=true;_trackPointerEvents=window.navigator.msPointerEnabled;_setPointerCapture='msSetPointerCapture';_releasePointerCapture='msReleasePointerCapture';_lostPointerCapture='MSLostPointerCapture';_pointerTypeTouch=2}var _ftscrollerMoving=false;var _trackTouchEvents=!_trackPointerEvents;var _useToggleableHardwareAcceleration=false;if('hasOwnProperty'in window){_useToggleableHardwareAcceleration=!window.hasOwnProperty('ArrayBuffer')}var _canClearSelection=(window.Selection&&window.Selection.prototype.removeAllRanges);if(!_useToggleableHardwareAcceleration&&document.createElement('div').style[_vendorStylePropertyPrefix+(_vendorStylePropertyPrefix?'P':'p')+'erspective']===undefined){_useToggleableHardwareAcceleration=true}var _transformProperty=_vendorStylePropertyPrefix+(_vendorStylePropertyPrefix?'T':'t')+'ransform';var _transitionProperty=_vendorStylePropertyPrefix+(_vendorStylePropertyPrefix?'T':'t')+'ransition';var _translateRulePrefix=_useToggleableHardwareAcceleration?'translate(':'translate3d(';var _transformPrefixes={x:'',y:'0,'};var _transformSuffixes={x:',0'+(_useToggleableHardwareAcceleration?')':',0)'),y:(_useToggleableHardwareAcceleration?')':',0)')};var _kFriction=0.998;var _kMinimumSpeed=0.01;(function(){var stylesheetContainerNode=document.getElementsByTagName('head')[0]||document.documentElement;var newStyleNode=document.createElement('style');var hardwareAccelerationRule;var _styleText;newStyleNode.type='text/css';if(_useToggleableHardwareAcceleration){hardwareAccelerationRule=_vendorCSSPrefix+'transform-style: preserve-3d;'}else{hardwareAccelerationRule=_vendorCSSPrefix+'transform: translateZ(0);'}_styleText=['.ftscroller_container { overflow: hidden; position: relative; max-height: 100%; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); -ms-touch-action: none }','.ftscroller_hwaccelerated { '+hardwareAccelerationRule+' }','.ftscroller_x, .ftscroller_y { position: relative; min-width: 100%; min-height: 100%; overflow: hidden }','.ftscroller_x { display: inline-block }','.ftscroller_scrollbar { pointer-events: none; position: absolute; width: 5px; height: 5px; border: 1px solid rgba(255, 255, 255, 0.3); -webkit-border-radius: 3px; border-radius: 6px; opacity: 0; '+_vendorCSSPrefix+'transition: opacity 350ms; z-index: 10; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box }','.ftscroller_scrollbarx { bottom: 2px; left: 2px }','.ftscroller_scrollbary { right: 2px; top: 2px }','.ftscroller_scrollbarinner { height: 100%; background: #000; -webkit-border-radius: 2px; border-radius: 4px / 6px }','.ftscroller_scrollbar.active { opacity: 0.5; '+_vendorCSSPrefix+'transition: none; -o-transition: all 0 none }'];if(newStyleNode.styleSheet){newStyleNode.styleSheet.cssText=_styleText.join('\n')}else{newStyleNode.appendChild(document.createTextNode(_styleText.join('\n')))}stylesheetContainerNode.insertBefore(newStyleNode,stylesheetContainerNode.firstChild)}());FTScroller=function(domNode,options){var key;var destroy,setSnapSize,scrollTo,scrollBy,updateDimensions,addEventListener,removeEventListener,setDisabledInputMethods,_startScroll,_updateScroll,_endScroll,_finalizeScroll,_interruptScroll,_flingScroll,_snapScroll,_getSnapPositionForIndexes,_getSnapIndexForPosition,_constrainAndRenderTargetScrollPosition,_limitToBounds,_initializeDOM,_existingDOMValid,_domChanged,_updateDimensions,_updateScrollbarDimensions,_updateElementPosition,_updateSegments,_setAxisPosition,_getPosition,_scheduleAxisPosition,_fireEvent,_childFocused,_modifyDistanceBeyondBounds,_distancesBeyondBounds,_startAnimation,_scheduleRender,_cancelAnimation,_addEventHandlers,_removeEventHandlers,_resetEventHandlers,_onTouchStart,_onTouchMove,_onTouchEnd,_onMouseDown,_onMouseMove,_onMouseUp,_onPointerDown,_onPointerMove,_onPointerUp,_onPointerCancel,_onPointerCaptureEnd,_onClick,_onMouseScroll,_captureInput,_releaseInputCapture,_getBoundingRect;var _instanceOptions={scrollbars:true,scrollingX:true,scrollingY:true,scrollBoundary:1,scrollResponseBoundary:1,alwaysScroll:false,contentWidth:undefined,contentHeight:undefined,snapping:false,snapSizeX:undefined,snapSizeY:undefined,singlePageScrolls:false,bouncing:true,flinging:true,updateOnChanges:true,updateOnWindowResize:false,baseAlignments:{x:-1,y:-1},windowScrollingActiveFlag:undefined,hwAccelerationClass:'ftscroller_hwaccelerated',enableRequestAnimationFrameSupport:true,maxFlingDuration:1000,disabledInputMethods:{mouse:false,touch:false,scroll:false,pointer:false,focus:false},scrollingClassName:undefined,flingBezier:new CubicBezier(0.103,0.389,0.307,0.966),bounceDecelerationBezier:new CubicBezier(0,0.5,0.5,1),bounceBezier:new CubicBezier(0.7,0,0.9,0.6),invertScrollWheel:true};var _publicSelf;var _self=this;var _scrollableMasterNode=domNode;var _containerNode;var _contentParentNode;var _scrollNodes={x:null,y:null};var _scrollbarNodes={x:null,y:null};var _metrics={container:{x:null,y:null},content:{x:null,y:null,rawX:null,rawY:null},scrollEnd:{x:null,y:null}};var _snapGridSize={x:false,y:false,userX:false,userY:false};var _snapIndex={x:0,y:0};var _baseSegment={x:0,y:0};var _activeSegment={x:0,y:0};var _inputIdentifier=false;var _inputIndex=0;var _inputCaptured=false;var _isScrolling=false;var _isDisplayingScroll=false;var _isAnimating=false;var _baseScrollPosition={x:0,y:0};var _lastScrollPosition={x:0,y:0};var _targetScrollPosition={x:0,y:0};var _scrollAtExtremity={x:null,y:null};var _preventClick=false;var _timeouts=[];var _hasBeenScrolled=false;var _baseScrollableAxes={};var _scrollableAxes={x:true,y:true};var _gestureStart={x:0,y:0,t:0};var _cumulativeScroll={x:0,y:0};var _eventHistory=[];var _domChangeDebouncer=false;var _scrollWheelEndDebouncer=false;var _animationFrameRequest=false;var _reqAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||false;var _cancelAnimationFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||false;var _eventListeners={'scrollstart':[],'scroll':[],'scrollend':[],'segmentwillchange':[],'segmentdidchange':[],'reachedstart':[],'reachedend':[],'scrollinteractionend':[]};var _mutationObserver;if(typeof FTScrollerOptions==='object'&&FTScrollerOptions){for(key in FTScrollerOptions){if(FTScrollerOptions.hasOwnProperty(key)&&_instanceOptions.hasOwnProperty(key)){_instanceOptions[key]=FTScrollerOptions[key]}}}if(options){for(key in options){if(options.hasOwnProperty(key)){if('paginatedSnap'===key){console.warn('FTScroller: "paginatedSnap" is deprecated; converting to "singlePageScrolls"');_instanceOptions.singlePageScrolls=options.paginatedSnap;continue}if(_instanceOptions.hasOwnProperty(key)){_instanceOptions[key]=options[key]}}}if(options.hasOwnProperty('snapSizeX')&&!isNaN(options.snapSizeX)){_snapGridSize.userX=_snapGridSize.x=options.snapSizeX}if(options.hasOwnProperty('snapSizeY')&&!isNaN(options.snapSizeY)){_snapGridSize.userY=_snapGridSize.y=options.snapSizeY}if(options.contentWidth&&options.contentHeight){options.updateOnChanges=false}}_instanceOptions.scrollResponseBoundary=Math.min(_instanceOptions.scrollBoundary,_instanceOptions.scrollResponseBoundary);if(_instanceOptions.scrollingX){_baseScrollableAxes.x=true}if(_instanceOptions.scrollingY){_baseScrollableAxes.y=true}_reqAnimationFrame=_instanceOptions.enableRequestAnimationFrameSupport&&_reqAnimationFrame;_cancelAnimationFrame=_reqAnimationFrame&&_cancelAnimationFrame;destroy=function destroy(removeElements){var i,l;_removeEventHandlers();_cancelAnimation();if(_domChangeDebouncer){window.clearTimeout(_domChangeDebouncer);_domChangeDebouncer=false}for(i=0,l=_timeouts.length;i<l;i=i+1){window.clearTimeout(_timeouts[i])}_timeouts.length=0;if(removeElements&&_scrollableMasterNode){while(_contentParentNode.firstChild){_scrollableMasterNode.appendChild(_contentParentNode.firstChild)}_scrollableMasterNode.removeChild(_containerNode)}_scrollableMasterNode=null;_containerNode=null;_contentParentNode=null;_scrollNodes.x=null;_scrollNodes.y=null;_scrollbarNodes.x=null;_scrollbarNodes.y=null;for(i in _eventListeners){if(_eventListeners.hasOwnProperty(i)){_eventListeners[i].length=0}}if(_ftscrollerMoving&&_ftscrollerMoving===_self){_ftscrollerMoving=false;if(_instanceOptions.windowScrollingActiveFlag){window[_instanceOptions.windowScrollingActiveFlag]=false}}};setSnapSize=function setSnapSize(width,height){_snapGridSize.userX=width;_snapGridSize.userY=height;_snapGridSize.x=width;_snapGridSize.y=height;_metrics.content.x=Math.ceil(_metrics.content.rawX/width)*width;_metrics.content.y=Math.ceil(_metrics.content.rawY/height)*height;_metrics.scrollEnd.x=_metrics.container.x-_metrics.content.x;_metrics.scrollEnd.y=_metrics.container.y-_metrics.content.y;_updateScrollbarDimensions();_snapScroll();_updateSegments(true)};scrollTo=function scrollTo(left,top,animationDuration){var targetPosition,duration,positions,axis,maxDuration=0,scrollPositionsToApply={};_endScroll(Date.now());positions={x:-left,y:-top};for(axis in _baseScrollableAxes){if(_baseScrollableAxes.hasOwnProperty(axis)){targetPosition=positions[axis];if(targetPosition===false){continue}targetPosition=Math.min(0,Math.max(_metrics.scrollEnd[axis],targetPosition));if(_instanceOptions.snapping&&_snapGridSize[axis]){targetPosition=Math.round(targetPosition/_snapGridSize[axis])*_snapGridSize[axis]}duration=animationDuration||0;if(duration===true){duration=Math.sqrt(Math.abs(_baseScrollPosition[axis]-targetPosition))*20}_setAxisPosition(axis,targetPosition,duration);scrollPositionsToApply[axis]=targetPosition;maxDuration=Math.max(maxDuration,duration)}}if(_baseScrollPosition.x!==positions.x||_baseScrollPosition.y!==positions.y){_hasBeenScrolled=true;_fireEvent('scrollstart',_getPosition());_fireEvent('scroll',_getPosition())}if(maxDuration){_timeouts.push(setTimeout(function(){var anAxis;for(anAxis in scrollPositionsToApply){if(scrollPositionsToApply.hasOwnProperty(anAxis)){_lastScrollPosition[anAxis]=scrollPositionsToApply[anAxis]}}_finalizeScroll()},maxDuration))}else{_finalizeScroll()}};scrollBy=function scrollBy(horizontal,vertical,animationDuration){scrollTo(parseFloat(horizontal)-_baseScrollPosition.x,parseFloat(vertical)-_baseScrollPosition.y,animationDuration)};updateDimensions=function updateDimensions(contentWidth,contentHeight,ignoreSnapScroll){options.contentWidth=contentWidth||options.contentWidth;options.contentHeight=contentHeight||options.contentHeight;_updateDimensions(!!ignoreSnapScroll)};addEventListener=function addEventListener(eventname,eventlistener){if(!_eventListeners.hasOwnProperty(eventname)){return false}_eventListeners[eventname].push(eventlistener);return true};removeEventListener=function removeEventListener(eventname,eventlistener){var i;if(!_eventListeners.hasOwnProperty(eventname)){return false}for(i=_eventListeners[eventname].length;i>=0;i=i-1){if(_eventListeners[eventname][i]===eventlistener){_eventListeners[eventname].splice(i,1)}}return true};setDisabledInputMethods=function setDisabledInputMethods(disabledInputMethods){var i,changed;for(i in _instanceOptions.disabledInputMethods){disabledInputMethods[i]=!!disabledInputMethods[i];if(_instanceOptions.disabledInputMethods[i]!==disabledInputMethods[i])changed=true;_instanceOptions.disabledInputMethods[i]=disabledInputMethods[i]}if(changed){_resetEventHandlers()}};_startScroll=function _startScroll(inputX,inputY,inputTime,rawEvent){var triggerScrollInterrupt=_isAnimating;if(inputTime<=0){inputTime=Date.now()}if(_instanceOptions.windowScrollingActiveFlag&&window[_instanceOptions.windowScrollingActiveFlag]){return false}if(triggerScrollInterrupt){_interruptScroll()}else{_preventClick=false}_gestureStart.x=inputX;_gestureStart.y=inputY;_gestureStart.t=inputTime;_targetScrollPosition.x=_lastScrollPosition.x;_targetScrollPosition.y=_lastScrollPosition.y;_eventHistory.length=0;_eventHistory.push({x:inputX,y:inputY,t:inputTime});if(triggerScrollInterrupt){_updateScroll(inputX,inputY,inputTime,rawEvent,triggerScrollInterrupt)}return true};_updateScroll=function _updateScroll(inputX,inputY,inputTime,rawEvent,scrollInterrupt){var axis,otherScrollerActive,distancesBeyondBounds;var initialScroll=false;var gesture={x:inputX-_gestureStart.x,y:inputY-_gestureStart.y};if(inputTime<=0){inputTime=Date.now()}_targetScrollPosition.x=_baseScrollPosition.x+gesture.x;_targetScrollPosition.y=_baseScrollPosition.y+gesture.y;if(!_isScrolling){if(_ftscrollerMoving&&_ftscrollerMoving!==_self){otherScrollerActive=true}else if(_instanceOptions.windowScrollingActiveFlag&&window[_instanceOptions.windowScrollingActiveFlag]){otherScrollerActive=true}if(otherScrollerActive){_releaseInputCapture();_inputIdentifier=false;if(_isDisplayingScroll){_cancelAnimation();if(!_snapScroll(true)){_finalizeScroll(true)}}return}}if(!_isDisplayingScroll){distancesBeyondBounds=_distancesBeyondBounds(_targetScrollPosition);if(!scrollInterrupt&&(!_scrollableAxes.x||Math.abs(gesture.x)<_instanceOptions.scrollResponseBoundary)&&(!_scrollableAxes.y||Math.abs(gesture.y)<_instanceOptions.scrollResponseBoundary)){return}if(_instanceOptions.bouncing||scrollInterrupt||(_scrollableAxes.x&&gesture.x&&distancesBeyondBounds.x<0)||(_scrollableAxes.y&&gesture.y&&distancesBeyondBounds.y<0)){rawEvent.preventDefault()}if(!_instanceOptions.bouncing&&!scrollInterrupt&&(!_scrollableAxes.x||!gesture.x||distancesBeyondBounds.x>0)&&(!_scrollableAxes.y||!gesture.y||distancesBeyondBounds.y>0)){_preventClick=true;return}_startAnimation();_isDisplayingScroll=true;_hasBeenScrolled=true;_isAnimating=true;initialScroll=true}else{rawEvent.preventDefault()}if(!_isScrolling){if((scrollInterrupt&&_instanceOptions.snapping)||(_scrollableAxes.x&&Math.abs(gesture.x)>=_instanceOptions.scrollBoundary)||(_scrollableAxes.y&&Math.abs(gesture.y)>=_instanceOptions.scrollBoundary)){_isScrolling=true;_preventClick=true;_ftscrollerMoving=_self;if(_instanceOptions.windowScrollingActiveFlag){window[_instanceOptions.windowScrollingActiveFlag]=_self}_fireEvent('scrollstart',_getPosition())}}if(_isScrolling){_captureInput()}if(_canClearSelection){window.getSelection().removeAllRanges()}_constrainAndRenderTargetScrollPosition();if(initialScroll){if(gesture.x>0){_baseScrollPosition.x-=_instanceOptions.scrollResponseBoundary}else if(gesture.x<0){_baseScrollPosition.x+=_instanceOptions.scrollResponseBoundary}if(gesture.y>0){_baseScrollPosition.y-=_instanceOptions.scrollResponseBoundary}else if(gesture.y<0){_baseScrollPosition.y+=_instanceOptions.scrollResponseBoundary}_targetScrollPosition.x=_baseScrollPosition.x+gesture.x;_targetScrollPosition.y=_baseScrollPosition.y+gesture.y;if(_instanceOptions.scrollingClassName){_containerNode.className+=' '+_instanceOptions.scrollingClassName}if(_instanceOptions.scrollbars){for(axis in _scrollableAxes){if(_scrollableAxes.hasOwnProperty(axis)){_scrollbarNodes[axis].className+=' active'}}}}_eventHistory.push({x:inputX,y:inputY,t:inputTime});if(_eventHistory.length>30){_eventHistory.splice(0,15)}};_endScroll=function _endScroll(inputTime,rawEvent){_releaseInputCapture();_inputIdentifier=false;_cancelAnimation();_fireEvent('scrollinteractionend',{});if(!_isScrolling){if(!_snapScroll(true)&&_isDisplayingScroll){_finalizeScroll(true)}return}_eventHistory[_eventHistory.length-1].t=inputTime;_isScrolling=false;_isDisplayingScroll=false;_ftscrollerMoving=false;if(_instanceOptions.windowScrollingActiveFlag){window[_instanceOptions.windowScrollingActiveFlag]=false}if(rawEvent){rawEvent.preventDefault()}if(!_flingScroll()&&!_snapScroll()){_finalizeScroll()}};_finalizeScroll=function _finalizeScroll(scrollCancelled){var i,l,axis,scrollEvent,scrollRegex;_isAnimating=false;_isDisplayingScroll=false;if(_instanceOptions.scrollingClassName){scrollRegex=new RegExp('(?:^|\\s)'+_instanceOptions.scrollingClassName+'(?!\\S)','g');_containerNode.className=_containerNode.className.replace(scrollRegex,'')}if(_instanceOptions.scrollbars){for(axis in _scrollableAxes){if(_scrollableAxes.hasOwnProperty(axis)){_scrollbarNodes[axis].className=_scrollbarNodes[axis].className.replace(/ ?active/g,'')}}}_baseScrollPosition.x=_lastScrollPosition.x;_baseScrollPosition.y=_lastScrollPosition.y;scrollEvent=_getPosition();if(!scrollCancelled){_fireEvent('scroll',scrollEvent);_updateSegments(true)}scrollEvent.cancelled=scrollCancelled;_fireEvent('scrollend',scrollEvent);for(axis in _scrollableAxes){if(_scrollableAxes.hasOwnProperty(axis)){_scrollNodes[axis].style[_transitionProperty]='';if(_instanceOptions.scrollbars){_scrollbarNodes[axis].style[_transitionProperty]=''}}}for(i=0,l=_timeouts.length;i<l;i=i+1){window.clearTimeout(_timeouts[i])}_timeouts.length=0};_interruptScroll=function _interruptScroll(){var axis,i,l;_isAnimating=false;_updateElementPosition();for(axis in _scrollableAxes){if(_scrollableAxes.hasOwnProperty(axis)){_setAxisPosition(axis,_baseScrollPosition[axis],16,_instanceOptions.bounceDecelerationBezier)}}_updateSegments(false);for(i=0,l=_timeouts.length;i<l;i=i+1){window.clearTimeout(_timeouts[i])}_timeouts.length=0};_flingScroll=function _flingScroll(){var i,axis,movementTime,movementSpeed,lastPosition,comparisonPosition,flingDuration,flingDistance,flingPosition,bounceDelay,bounceDistance,bounceDuration,bounceTarget,boundsBounce,modifiedDistance,flingBezier,timeProportion,boundsCrossDelay,flingStartSegment,beyondBoundsFlingDistance,baseFlingComponent;var maxAnimationTime=0;var moveRequired=false;var scrollPositionsToApply={};if(_eventHistory.length===1||!_instanceOptions.flinging||_inputIdentifier==='scrollwheel'){return false}for(axis in _scrollableAxes){if(_scrollableAxes.hasOwnProperty(axis)){bounceDuration=350;bounceDistance=0;boundsBounce=false;bounceTarget=false;boundsCrossDelay=undefined;flingBezier=_instanceOptions.flingBezier;lastPosition=_eventHistory[_eventHistory.length-1];comparisonPosition=_eventHistory[_eventHistory.length-2];for(i=_eventHistory.length-3;i>=0;i=i-1){if(lastPosition.t-_eventHistory[i].t>100){break}comparisonPosition=_eventHistory[i]}movementTime=lastPosition.t-comparisonPosition.t;if(!movementTime){movementTime=16}movementSpeed=(lastPosition[axis]-comparisonPosition[axis])/movementTime;if(Math.abs(movementSpeed)<_kMinimumSpeed){flingDuration=0;flingDistance=0}else{flingDuration=Math.log(_kMinimumSpeed/Math.abs(movementSpeed))/Math.log(_kFriction);flingDistance=movementSpeed*(1-Math.pow(_kFriction,flingDuration+1))/(1-_kFriction)}flingPosition=Math.floor(_lastScrollPosition[axis]+flingDistance);if(!_instanceOptions.bouncing){if(_lastScrollPosition[axis]===0&&flingPosition>0){flingPosition=0}else if(_lastScrollPosition[axis]===_metrics.scrollEnd[axis]&&flingPosition<_lastScrollPosition[axis]){flingPosition=_lastScrollPosition[axis]}}if(_instanceOptions.singlePageScrolls&&_instanceOptions.snapping){flingStartSegment=-_lastScrollPosition[axis]/_snapGridSize[axis];if(_baseSegment[axis]<flingStartSegment){flingStartSegment=Math.floor(flingStartSegment)}else{flingStartSegment=Math.ceil(flingStartSegment)}if(flingPosition>-(_baseSegment[axis]-1)*_snapGridSize[axis]){bounceDistance=flingPosition+(_baseSegment[axis]-1)*_snapGridSize[axis]}else if(flingPosition<-(_baseSegment[axis]+1)*_snapGridSize[axis]){bounceDistance=flingPosition+(_baseSegment[axis]+1)*_snapGridSize[axis]}else if(Math.abs(movementSpeed)>_kMinimumSpeed){if(movementSpeed<0){flingPosition=Math.floor(_lastScrollPosition[axis]/_snapGridSize[axis])*_snapGridSize[axis]}else{flingPosition=Math.ceil(_lastScrollPosition[axis]/_snapGridSize[axis])*_snapGridSize[axis]}flingDuration=Math.min(_instanceOptions.maxFlingDuration,flingDuration*(flingPosition-_lastScrollPosition[axis])/flingDistance)}}else if(_instanceOptions.snapping){bounceDistance=flingPosition-(Math.round(flingPosition/_snapGridSize[axis])*_snapGridSize[axis])}if(flingPosition-bounceDistance>0){bounceDistance=flingPosition;boundsBounce=true}else if(flingPosition-bounceDistance<_metrics.scrollEnd[axis]){bounceDistance=flingPosition-_metrics.scrollEnd[axis];boundsBounce=true}if(bounceDistance){if(boundsBounce&&_instanceOptions.bouncing&&flingDistance){flingDistance=Math.floor(flingDistance);if(flingPosition>0){beyondBoundsFlingDistance=flingPosition-Math.max(0,_lastScrollPosition[axis])}else{beyondBoundsFlingDistance=flingPosition-Math.min(_metrics.scrollEnd[axis],_lastScrollPosition[axis])}baseFlingComponent=flingDistance-beyondBoundsFlingDistance;if(!flingDistance||!flingDuration){timeProportion=0}else{timeProportion=flingBezier._getCoordinateForT(flingBezier.getTForY((flingDistance-beyondBoundsFlingDistance)/flingDistance,1/flingDuration),flingBezier._p1.x,flingBezier._p2.x);boundsCrossDelay=timeProportion*flingDuration}modifiedDistance=Math.ceil(beyondBoundsFlingDistance/8);if(Math.abs(modifiedDistance)>_metrics.container[axis]/2){if(modifiedDistance<0){modifiedDistance=-Math.floor(_metrics.container[axis]/2)}else{modifiedDistance=Math.floor(_metrics.container[axis]/2)}}if(flingPosition>0){bounceTarget=0}else{bounceTarget=_metrics.scrollEnd[axis]}if(timeProportion===0){flingDuration=flingDuration/6;flingPosition=_lastScrollPosition[axis]+baseFlingComponent+modifiedDistance;bounceDelay=flingDuration}else{bounceDelay=(timeProportion+((1-timeProportion)/6))*flingDuration;_scheduleAxisPosition(axis,(_lastScrollPosition[axis]+baseFlingComponent+modifiedDistance),((1-timeProportion)*flingDuration/6),_instanceOptions.bounceDecelerationBezier,boundsCrossDelay);flingBezier=flingBezier.divideAtX(bounceDelay/flingDuration,1/flingDuration)[0];flingDuration=bounceDelay;flingPosition=(_lastScrollPosition[axis]+baseFlingComponent+modifiedDistance)}}else if((flingDistance<0&&bounceDistance<flingDistance)||(flingDistance>0&&bounceDistance>flingDistance)){flingPosition=flingPosition-Math.floor(flingDistance/2);bounceDistance=bounceDistance-Math.floor(flingDistance/2);bounceDuration=Math.sqrt(Math.abs(bounceDistance))*50;bounceTarget=flingPosition-bounceDistance;flingDuration=350;bounceDelay=flingDuration*0.97}else{flingPosition=flingPosition-bounceDistance;if(!flingDistance){flingDuration=bounceDuration}else if((flingDistance<0&&bounceDistance<0)||(flingDistance>0&&bounceDistance>0)){timeProportion=flingBezier._getCoordinateForT(flingBezier.getTForY((Math.abs(flingDistance)-Math.abs(bounceDistance))/Math.abs(flingDistance),1/flingDuration),flingBezier._p1.x,flingBezier._p2.x);flingBezier=flingBezier.divideAtX(timeProportion,1/flingDuration)[0];flingDuration=Math.round(flingDuration*timeProportion)}bounceDistance=0;bounceDuration=0}}if(flingPosition===_lastScrollPosition[axis]&&!bounceDistance){continue}moveRequired=true;_setAxisPosition(axis,flingPosition,flingDuration,flingBezier,boundsCrossDelay);if(bounceDistance&&bounceDuration){_scheduleAxisPosition(axis,bounceTarget,bounceDuration,_instanceOptions.bounceBezier,bounceDelay)}maxAnimationTime=Math.max(maxAnimationTime,bounceDistance?(bounceDelay+bounceDuration):flingDuration);scrollPositionsToApply[axis]=(bounceTarget===false)?flingPosition:bounceTarget}}if(moveRequired&&maxAnimationTime){_timeouts.push(setTimeout(function(){var anAxis;for(anAxis in scrollPositionsToApply){if(scrollPositionsToApply.hasOwnProperty(anAxis)){_lastScrollPosition[anAxis]=scrollPositionsToApply[anAxis]}}_finalizeScroll()},maxAnimationTime))}return moveRequired};_snapScroll=function _snapScroll(scrollCancelled){var axis;var snapDuration=scrollCancelled?100:350;var targetPosition=_lastScrollPosition;if(_instanceOptions.snapping){_snapIndex=_getSnapIndexForPosition(targetPosition);targetPosition=_getSnapPositionForIndexes(_snapIndex,targetPosition)}targetPosition=_limitToBounds(targetPosition);var snapRequired=false;for(axis in _baseScrollableAxes){if(_baseScrollableAxes.hasOwnProperty(axis)){if(targetPosition[axis]!==_lastScrollPosition[axis]){snapRequired=true}}}if(!snapRequired){return false}for(axis in _baseScrollableAxes){if(_baseScrollableAxes.hasOwnProperty(axis)){_setAxisPosition(axis,targetPosition[axis],snapDuration)}}_timeouts.push(setTimeout(function(){_lastScrollPosition=targetPosition;_finalizeScroll(scrollCancelled)},snapDuration));return true};_getSnapIndexForPosition=function _getSnapIndexForPosition(coordinates){var axis;var indexes={x:0,y:0};for(axis in _scrollableAxes){if(_scrollableAxes.hasOwnProperty(axis)&&_snapGridSize[axis]){indexes[axis]=Math.round(coordinates[axis]/_snapGridSize[axis])}}return indexes};_getSnapPositionForIndexes=function _getSnapPositionForIndexes(indexes,currentCoordinates){var axis;var coordinatesToReturn={x:currentCoordinates.x,y:currentCoordinates.y};for(axis in _scrollableAxes){if(_scrollableAxes.hasOwnProperty(axis)){coordinatesToReturn[axis]=indexes[axis]*_snapGridSize[axis]}}return coordinatesToReturn};_constrainAndRenderTargetScrollPosition=function _constrainAndRenderTargetScrollPosition(){var axis,upperBound,lowerBound;for(axis in _scrollableAxes){if(_scrollableAxes.hasOwnProperty(axis)){upperBound=0;lowerBound=_metrics.scrollEnd[axis];if(_instanceOptions.singlePageScrolls&&_instanceOptions.snapping){upperBound=Math.min(upperBound,-(_baseSegment[axis]-1)*_snapGridSize[axis]);lowerBound=Math.max(lowerBound,-(_baseSegment[axis]+1)*_snapGridSize[axis])}if(_targetScrollPosition[axis]>upperBound){_targetScrollPosition[axis]=upperBound+_modifyDistanceBeyondBounds(_targetScrollPosition[axis]-upperBound,axis)}else if(_targetScrollPosition[axis]<lowerBound){_targetScrollPosition[axis]=lowerBound+_modifyDistanceBeyondBounds(_targetScrollPosition[axis]-lowerBound,axis)}}}if(!_reqAnimationFrame){_scheduleRender()}};_limitToBounds=function _limitToBounds(coordinates){var axis;var coordinatesToReturn={x:coordinates.x,y:coordinates.y};for(axis in _scrollableAxes){if(_scrollableAxes.hasOwnProperty(axis)){if(coordinates[axis]>0){coordinatesToReturn[axis]=0;continue}if(coordinates[axis]<_metrics.scrollEnd[axis]){coordinatesToReturn[axis]=_metrics.scrollEnd[axis];continue}}}return coordinatesToReturn};_initializeDOM=function _initializeDOM(){var offscreenFragment,offscreenNode,scrollYParent;if(_existingDOMValid()){return}offscreenFragment=_scrollableMasterNode.ownerDocument.createDocumentFragment();offscreenNode=document.createElement('DIV');offscreenFragment.appendChild(offscreenNode);offscreenNode.innerHTML=FTScroller.prototype.getPrependedHTML(!_instanceOptions.scrollingX,!_instanceOptions.scrollingY,_instanceOptions.hwAccelerationClass)+FTScroller.prototype.getAppendedHTML(!_instanceOptions.scrollingX,!_instanceOptions.scrollingY,_instanceOptions.hwAccelerationClass,_instanceOptions.scrollbars);_containerNode=offscreenNode.firstElementChild;scrollYParent=_containerNode;if(_instanceOptions.scrollingX){_scrollNodes.x=_containerNode.firstElementChild;scrollYParent=_scrollNodes.x;if(_instanceOptions.scrollbars){_scrollbarNodes.x=_containerNode.getElementsByClassName('ftscroller_scrollbarx')[0]}}if(_instanceOptions.scrollingY){_scrollNodes.y=scrollYParent.firstElementChild;if(_instanceOptions.scrollbars){_scrollbarNodes.y=_containerNode.getElementsByClassName('ftscroller_scrollbary')[0]}_contentParentNode=_scrollNodes.y}else{_contentParentNode=_scrollNodes.x}while(_scrollableMasterNode.firstChild){_contentParentNode.appendChild(_scrollableMasterNode.firstChild)}_scrollableMasterNode.appendChild(_containerNode)};_existingDOMValid=function _existingDOMValid(){var scrollerContainer,layerX,layerY,yParent,scrollerX,scrollerY,candidates,i,l;scrollerContainer=_scrollableMasterNode.firstElementChild;if(!scrollerContainer||scrollerContainer.className.indexOf('ftscroller_container')===-1){return}if(_instanceOptions.scrollingX){layerX=scrollerContainer.firstElementChild;if(!layerX||layerX.className.indexOf('ftscroller_x')===-1){return}yParent=layerX;if(_instanceOptions.scrollbars){candidates=scrollerContainer.getElementsByClassName('ftscroller_scrollbarx');if(candidates){for(i=0,l=candidates.length;i<l;i=i+1){if(candidates[i].parentNode===scrollerContainer){scrollerX=candidates[i];break}}}if(!scrollerX){return}}}else{yParent=scrollerContainer}if(_instanceOptions.scrollingY){layerY=yParent.firstElementChild;if(!layerY||layerY.className.indexOf('ftscroller_y')===-1){return}if(_instanceOptions.scrollbars){candidates=scrollerContainer.getElementsByClassName('ftscroller_scrollbary');if(candidates){for(i=0,l=candidates.length;i<l;i=i+1){if(candidates[i].parentNode===scrollerContainer){scrollerY=candidates[i];break}}}if(!scrollerY){return}}}_containerNode=scrollerContainer;if(layerX){_scrollNodes.x=layerX}if(layerY){_scrollNodes.y=layerY}if(scrollerX){_scrollbarNodes.x=scrollerX}if(scrollerY){_scrollbarNodes.y=scrollerY}if(_instanceOptions.scrollingY){_contentParentNode=layerY}else{_contentParentNode=layerX}return true};_domChanged=function _domChanged(e){if(_domChangeDebouncer){window.clearTimeout(_domChangeDebouncer)}if(e&&e.type==='resize'){_updateDimensions()}else{_domChangeDebouncer=setTimeout(function(){_updateDimensions()},100)}};_updateDimensions=function _updateDimensions(ignoreSnapScroll){var axis;if(!_containerNode||!_contentParentNode){return false}if(_domChangeDebouncer){window.clearTimeout(_domChangeDebouncer);_domChangeDebouncer=false}var containerWidth,containerHeight,startAlignments;startAlignments={x:false,y:false};for(axis in startAlignments){if(startAlignments.hasOwnProperty(axis)){if(_lastScrollPosition[axis]===0){startAlignments[axis]=-1}else if(_lastScrollPosition[axis]<=_metrics.scrollEnd[axis]){startAlignments[axis]=1}else if(_lastScrollPosition[axis]*2<=_metrics.scrollEnd[axis]+5&&_lastScrollPosition[axis]*2>=_metrics.scrollEnd[axis]-5){startAlignments[axis]=0}}}containerWidth=_containerNode.offsetWidth;containerHeight=_containerNode.offsetHeight;var rawScrollWidth=options.contentWidth||_contentParentNode.offsetWidth;var rawScrollHeight=options.contentHeight||_contentParentNode.offsetHeight;var scrollWidth=rawScrollWidth;var scrollHeight=rawScrollHeight;var targetPosition={x:_lastScrollPosition.x,y:_lastScrollPosition.y};if(!_snapGridSize.userX){_snapGridSize.x=containerWidth}if(!_snapGridSize.userY){_snapGridSize.y=containerHeight}if(_instanceOptions.snapping){if(_snapGridSize.userX){scrollWidth=Math.ceil(scrollWidth/_snapGridSize.userX)*_snapGridSize.userX}else{scrollWidth=Math.ceil(scrollWidth/_snapGridSize.x)*_snapGridSize.x}if(_snapGridSize.userY){scrollHeight=Math.ceil(scrollHeight/_snapGridSize.userY)*_snapGridSize.userY}else{scrollHeight=Math.ceil(scrollHeight/_snapGridSize.y)*_snapGridSize.y}}if(_metrics.container.x===containerWidth&&_metrics.container.y===containerHeight&&_metrics.content.x===scrollWidth&&_metrics.content.y===scrollHeight){return}_metrics.container.x=containerWidth;_metrics.container.y=containerHeight;_metrics.content.x=scrollWidth;_metrics.content.rawX=rawScrollWidth;_metrics.content.y=scrollHeight;_metrics.content.rawY=rawScrollHeight;_metrics.scrollEnd.x=containerWidth-scrollWidth;_metrics.scrollEnd.y=containerHeight-scrollHeight;_updateScrollbarDimensions();if(_isScrolling){_lastScrollPosition.x--;_lastScrollPosition.y--;_constrainAndRenderTargetScrollPosition()}else{if(!ignoreSnapScroll&&_instanceOptions.snapping){_updateSegments();targetPosition=_getSnapPositionForIndexes(_snapIndex,_lastScrollPosition)}for(axis in targetPosition){if(targetPosition.hasOwnProperty(axis)){if(_metrics.container[axis]<_metrics.content[axis]){if(_hasBeenScrolled&&_instanceOptions.baseAlignments[axis]!==startAlignments[axis]){continue}}if(_instanceOptions.baseAlignments[axis]===1){targetPosition[axis]=_metrics.scrollEnd[axis]}else if(_instanceOptions.baseAlignments[axis]===0){targetPosition[axis]=Math.floor(_metrics.scrollEnd[axis]/2)}else if(_instanceOptions.baseAlignments[axis]===-1){targetPosition[axis]=0}}}targetPosition=_limitToBounds(targetPosition);if(_instanceOptions.scrollingX&&targetPosition.x!==_lastScrollPosition.x){_setAxisPosition('x',targetPosition.x,0);_baseScrollPosition.x=targetPosition.x}if(_instanceOptions.scrollingY&&targetPosition.y!==_lastScrollPosition.y){_setAxisPosition('y',targetPosition.y,0);_baseScrollPosition.y=targetPosition.y}}};_updateScrollbarDimensions=function _updateScrollbarDimensions(){if(_instanceOptions.scrollbars){if(_instanceOptions.scrollingX){_scrollbarNodes.x.style.width=Math.max(6,Math.round(_metrics.container.x*(_metrics.container.x/_metrics.content.x)-4))+'px'}if(_instanceOptions.scrollingY){_scrollbarNodes.y.style.height=Math.max(6,Math.round(_metrics.container.y*(_metrics.container.y/_metrics.content.y)-4))+'px'}}_scrollableAxes={};if(_instanceOptions.scrollingX&&(_metrics.content.x>_metrics.container.x||_instanceOptions.alwaysScroll)){_scrollableAxes.x=true}if(_instanceOptions.scrollingY&&(_metrics.content.y>_metrics.container.y||_instanceOptions.alwaysScroll)){_scrollableAxes.y=true}};_updateElementPosition=function _updateElementPosition(){var axis,computedStyle,splitStyle;for(axis in _scrollableAxes){if(_scrollableAxes.hasOwnProperty(axis)){computedStyle=window.getComputedStyle(_scrollNodes[axis],null)[_vendorTransformLookup];splitStyle=computedStyle.split(', ');if(splitStyle.length===6){_baseScrollPosition[axis]=parseInt(splitStyle[(axis==='y')?5:4],10)}else{_baseScrollPosition[axis]=parseInt(splitStyle[(axis==='y')?13:12],10)}_lastScrollPosition[axis]=_baseScrollPosition[axis]}}};_updateSegments=function _updateSegments(scrollFinalised){var axis;var newSegment={x:0,y:0};if(!_instanceOptions.snapping){return}for(axis in _scrollableAxes){if(_scrollableAxes.hasOwnProperty(axis)){newSegment[axis]=Math.max(0,Math.min(Math.ceil(_metrics.content[axis]/_snapGridSize[axis])-1,Math.round(-_lastScrollPosition[axis]/_snapGridSize[axis])))}}if(newSegment.x!==_activeSegment.x||newSegment.y!==_activeSegment.y){_activeSegment.x=newSegment.x;_activeSegment.y=newSegment.y;_fireEvent('segmentwillchange',{segmentX:newSegment.x,segmentY:newSegment.y})}if(scrollFinalised){if(newSegment.x!==_baseSegment.x||newSegment.y!==_baseSegment.y){_baseSegment.x=newSegment.x;_baseSegment.y=newSegment.y;_fireEvent('segmentdidchange',{segmentX:newSegment.x,segmentY:newSegment.y})}}};_setAxisPosition=function _setAxisPosition(axis,position,animationDuration,animationBezier,boundsCrossDelay){var transitionCSSString,newPositionAtExtremity=null;if(!_scrollNodes[axis]){return false}if(animationDuration){if(!animationBezier){animationBezier=_instanceOptions.flingBezier}transitionCSSString=_vendorCSSPrefix+'transform '+animationDuration+'ms '+animationBezier.toString()}else{transitionCSSString=''}_scrollNodes[axis].style[_transitionProperty]=transitionCSSString;if(_instanceOptions.scrollbars){_scrollbarNodes[axis].style[_transitionProperty]=transitionCSSString}_scrollNodes[axis].style[_transformProperty]=_translateRulePrefix+_transformPrefixes[axis]+position+'px'+_transformSuffixes[axis];if(_instanceOptions.scrollbars){_scrollbarNodes[axis].style[_transformProperty]=_translateRulePrefix+_transformPrefixes[axis]+(-position*_metrics.container[axis]/_metrics.content[axis])+'px'+_transformSuffixes[axis]}if(position>=0){newPositionAtExtremity='start'}else if(position<=_metrics.scrollEnd[axis]){newPositionAtExtremity='end'}if(newPositionAtExtremity!==_scrollAtExtremity[axis]){if(newPositionAtExtremity!==null){if(animationDuration){_timeouts.push(setTimeout(function(){_fireEvent('reached'+newPositionAtExtremity,{axis:axis})},boundsCrossDelay||animationDuration))}else{_fireEvent('reached'+newPositionAtExtremity,{axis:axis})}}_scrollAtExtremity[axis]=newPositionAtExtremity}if(!animationDuration){_lastScrollPosition[axis]=position}};_getPosition=function _getPosition(){return{scrollLeft:-_lastScrollPosition.x,scrollTop:-_lastScrollPosition.y}};_scheduleAxisPosition=function _scheduleAxisPosition(axis,position,animationDuration,animationBezier,afterDelay){_timeouts.push(setTimeout(function(){_setAxisPosition(axis,position,animationDuration,animationBezier)},afterDelay))};_fireEvent=function _fireEvent(eventName,eventObject){var i,l;eventObject.srcObject=_publicSelf;for(i=0,l=_eventListeners[eventName].length;i<l;i=i+1){try{_eventListeners[eventName][i](eventObject)}catch(error){if(window.console&&window.console.error){if(error.message){window.console.error(error.message+' ('+error.sourceURL+', line '+error.line+')')}else{window.console.error('Error encountered executing FTScroller event listener callback for ['+eventName+']. Add a "debugger" statement here to obtain a full backtrace.');if(window.console.dir)window.console.dir(error)}}}}};_childFocused=function _childFocused(event){var offset,axis,visibleChildPortion;var focusedNodeRect=_getBoundingRect(event.target);var containerRect=_getBoundingRect(_containerNode);var edgeMap={x:'left',y:'top'};var opEdgeMap={x:'right',y:'bottom'};var dimensionMap={x:'width',y:'height'};if(_inputIdentifier!==false){return}for(axis in _scrollableAxes){if(_scrollableAxes.hasOwnProperty(axis)){if(focusedNodeRect[edgeMap[axis]]>=containerRect[edgeMap[axis]]&&focusedNodeRect[opEdgeMap[axis]]<=containerRect[opEdgeMap[axis]]){continue}if(focusedNodeRect[dimensionMap[axis]]>containerRect[dimensionMap[axis]]){visibleChildPortion=focusedNodeRect[dimensionMap[axis]]-Math.max(0,containerRect[edgeMap[axis]]-focusedNodeRect[edgeMap[axis]])-Math.max(0,focusedNodeRect[opEdgeMap[axis]]-containerRect[opEdgeMap[axis]]);if(visibleChildPortion>=(containerRect[dimensionMap[axis]]/2)){continue}}offset=-Math.round((focusedNodeRect[dimensionMap[axis]]/2)-_lastScrollPosition[axis]+focusedNodeRect[edgeMap[axis]]-containerRect[edgeMap[axis]]-(containerRect[dimensionMap[axis]]/2));offset=Math.min(0,Math.max(_metrics.scrollEnd[axis],offset));_setAxisPosition(axis,offset,0);_baseScrollPosition[axis]=offset}}_fireEvent('scroll',_getPosition())};_modifyDistanceBeyondBounds=function _modifyDistanceBeyondBounds(distance,axis){if(!_instanceOptions.bouncing){return 0}var e=Math.exp(distance/_metrics.container[axis]);return Math.round(_metrics.container[axis]*0.6*(e-1)/(e+1))};_distancesBeyondBounds=function _distancesBeyondBounds(positions){var axis,position;var distances={};for(axis in positions){if(positions.hasOwnProperty(axis)){position=positions[axis];if(position>=0){distances[axis]=position}else if(position>_metrics.scrollEnd[axis]){distances[axis]=-1}else{distances[axis]=_metrics.scrollEnd[axis]-position}}}return distances};_startAnimation=function _startAnimation(){if(_reqAnimationFrame){_cancelAnimation();_animationFrameRequest=_reqAnimationFrame(_scheduleRender)}};_scheduleRender=function _scheduleRender(){var axis,positionUpdated;if(_reqAnimationFrame){_animationFrameRequest=_reqAnimationFrame(_scheduleRender)}for(axis in _scrollableAxes){if(_scrollableAxes.hasOwnProperty(axis)&&_targetScrollPosition[axis]!==_lastScrollPosition[axis]){_setAxisPosition(axis,_targetScrollPosition[axis]);positionUpdated=true}}if(_isScrolling&&positionUpdated){_fireEvent('scroll',_getPosition());_updateSegments(false)}};_cancelAnimation=function _cancelAnimation(){if(_animationFrameRequest===false||!_cancelAnimationFrame){return}_cancelAnimationFrame(_animationFrameRequest);_animationFrameRequest=false};_resetEventHandlers=function(){_removeEventHandlers();_addEventHandlers()};_addEventHandlers=function _addEventHandlers(){var MutationObserver;if(!_containerNode){return}if(_trackPointerEvents&&!_instanceOptions.disabledInputMethods.pointer){if(_pointerEventsPrefixed){_containerNode.addEventListener('MSPointerDown',_onPointerDown);_containerNode.addEventListener('MSPointerMove',_onPointerMove);_containerNode.addEventListener('MSPointerUp',_onPointerUp);_containerNode.addEventListener('MSPointerCancel',_onPointerCancel)}else{_containerNode.addEventListener('pointerdown',_onPointerDown);_containerNode.addEventListener('pointermove',_onPointerMove);_containerNode.addEventListener('pointerup',_onPointerUp);_containerNode.addEventListener('pointercancel',_onPointerCancel)}}else{if(_trackTouchEvents&&!_instanceOptions.disabledInputMethods.touch){_containerNode.addEventListener('touchstart',_onTouchStart);_containerNode.addEventListener('touchmove',_onTouchMove);_containerNode.addEventListener('touchend',_onTouchEnd);_containerNode.addEventListener('touchcancel',_onTouchEnd)}if(!_instanceOptions.disabledInputMethods.mouse){_containerNode.addEventListener('mousedown',_onMouseDown)}}if(!_instanceOptions.disabledInputMethods.scroll){_containerNode.addEventListener('DOMMouseScroll',_onMouseScroll);_containerNode.addEventListener('mousewheel',_onMouseScroll)}if(!_instanceOptions.disabledInputMethods.mouse||!_instanceOptions.disabledInputMethods.touch||!_instanceOptions.disabledInputMethods.pointer){if(_trackPointerEvents){document.addEventListener('click',_onClick,true)}else{_containerNode.addEventListener('click',_onClick,true)}}if(!_instanceOptions.disabledInputMethods.focus){_contentParentNode.addEventListener('focus',_childFocused)}if(_instanceOptions.updateOnChanges){if(!_mutationObserver){MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window[_vendorStylePropertyPrefix+'MutationObserver'];if(MutationObserver){_mutationObserver=new MutationObserver(_domChanged)}}if(_mutationObserver){_mutationObserver.observe(_contentParentNode,{childList:true,characterData:true,subtree:true})}else{_contentParentNode.addEventListener('DOMSubtreeModified',function(e){if(e&&(e.srcElement===_contentParentNode||e.srcElement.className.indexOf('ftscroller_')!==-1)){return}_domChanged()},true)}_contentParentNode.addEventListener('load',_domChanged)}if(_instanceOptions.updateOnWindowResize){window.addEventListener('resize',_domChanged)}};_removeEventHandlers=function _removeEventHandlers(){if(_containerNode){_containerNode.removeEventListener('MSPointerDown',_onPointerDown);_containerNode.removeEventListener('MSPointerMove',_onPointerMove);_containerNode.removeEventListener('MSPointerUp',_onPointerUp);_containerNode.removeEventListener('MSPointerCancel',_onPointerCancel);_containerNode.removeEventListener('pointerdown',_onPointerDown);_containerNode.removeEventListener('pointermove',_onPointerMove);_containerNode.removeEventListener('pointerup',_onPointerUp);_containerNode.removeEventListener('pointercancel',_onPointerCancel);_containerNode.removeEventListener('touchstart',_onTouchStart);_containerNode.removeEventListener('touchmove',_onTouchMove);_containerNode.removeEventListener('touchend',_onTouchEnd);_containerNode.removeEventListener('touchcancel',_onTouchEnd);_containerNode.removeEventListener('mousedown',_onMouseDown);_containerNode.removeEventListener('DOMMouseScroll',_onMouseScroll);_containerNode.removeEventListener('mousewheel',_onMouseScroll);_containerNode.removeEventListener('click',_onClick,true)}if(_contentParentNode){_contentParentNode.removeEventListener('focus',_childFocused);_contentParentNode.removeEventListener('DOMSubtreeModified',_domChanged);_contentParentNode.removeEventListener('load',_domChanged)}if(_mutationObserver){_mutationObserver.disconnect()}document.removeEventListener('mousemove',_onMouseMove);document.removeEventListener('mouseup',_onMouseUp);document.removeEventListener('click',_onClick,true);window.removeEventListener('resize',_domChanged)};_onTouchStart=function _onTouchStart(startEvent){var i,l,touchEvent;if(_inputIdentifier){for(i=0,l=startEvent.touches.length;i<l;i=i+1){if(startEvent.touches[i].identifier===_inputIdentifier){_inputIndex=i}}return}touchEvent=startEvent.touches[0];_inputIdentifier=touchEvent.identifier;_inputIndex=0;_startScroll(touchEvent.clientX,touchEvent.clientY,startEvent.timeStamp,startEvent)};_onTouchMove=function _onTouchMove(moveEvent){if(_inputIdentifier===false){return}var touchEvent=moveEvent.touches[_inputIndex];_updateScroll(touchEvent.clientX,touchEvent.clientY,moveEvent.timeStamp,moveEvent)};_onTouchEnd=function _onTouchEnd(endEvent){var i,l;if(endEvent.touches){for(i=0,l=endEvent.touches.length;i<l;i=i+1){if(endEvent.touches[i].identifier===_inputIdentifier){_inputIndex=i;return}}}_endScroll(endEvent.timeStamp,endEvent)};_onMouseDown=function _onMouseDown(startEvent){if((startEvent.button&&startEvent.button===2)||startEvent.ctrlKey){return}if(_containerNode.setCapture){_containerNode.setCapture()}document.addEventListener('mousemove',_onMouseMove,true);document.addEventListener('mouseup',_onMouseUp,true);_inputIdentifier=startEvent.button||1;_inputIndex=0;_startScroll(startEvent.clientX,startEvent.clientY,startEvent.timeStamp,startEvent)};_onMouseMove=function _onMouseMove(moveEvent){if(!_inputIdentifier){return}_updateScroll(moveEvent.clientX,moveEvent.clientY,moveEvent.timeStamp,moveEvent)};_onMouseUp=function _onMouseUp(endEvent){if(endEvent.button&&endEvent.button!==_inputIdentifier){return}document.removeEventListener('mousemove',_onMouseMove,true);document.removeEventListener('mouseup',_onMouseUp,true);if(_containerNode.releaseCapture){_containerNode.releaseCapture()}_endScroll(endEvent.timeStamp,endEvent)};_onPointerDown=function _onPointerDown(startEvent){if(_inputIdentifier&&!startEvent.isPrimary){return}if(startEvent.pointerType===_pointerTypeTouch){if(_instanceOptions.disabledInputMethods.touch){return}}else if(_instanceOptions.disabledInputMethods.mouse){return}_inputIdentifier=startEvent.pointerId;_startScroll(startEvent.clientX,startEvent.clientY,startEvent.timeStamp,startEvent)};_onPointerMove=function _onPointerMove(moveEvent){if(_inputIdentifier!==moveEvent.pointerId){return}_updateScroll(moveEvent.clientX,moveEvent.clientY,moveEvent.timeStamp,moveEvent)};_onPointerUp=function _onPointerUp(endEvent){if(_inputIdentifier!==endEvent.pointerId){return}_endScroll(endEvent.timeStamp,endEvent)};_onPointerCancel=function _onPointerCancel(endEvent){_endScroll(endEvent.timeStamp,endEvent)};_onPointerCaptureEnd=function _onPointerCaptureEnd(event){_inputCaptured=false};_onClick=function _onClick(clickEvent){if(!_preventClick){return true}clickEvent.preventDefault();clickEvent.stopPropagation();if(!_inputIdentifier){_preventClick=false}return false};_onMouseScroll=function _onMouseScroll(event){var scrollDeltaX,scrollDeltaY;if(_inputIdentifier!=='scrollwheel'){if(_inputIdentifier!==false){return true}_inputIdentifier='scrollwheel';_cumulativeScroll.x=0;_cumulativeScroll.y=0;if(!_startScroll(event.clientX,event.clientY,Date.now(),event)){return}}if(event.wheelDelta){if(event.wheelDeltaX){scrollDeltaX=event.wheelDeltaX/2;scrollDeltaY=event.wheelDeltaY/2}else{scrollDeltaX=0;scrollDeltaY=event.wheelDelta/2}}else{if(event.axis&&event.axis===event.HORIZONTAL_AXIS){scrollDeltaX=event.detail*-10;scrollDeltaY=0}else{scrollDeltaX=0;scrollDeltaY=event.detail*-10}}if(!_instanceOptions.invertScrollWheel&&((_instanceOptions.scrollingX&&!_instanceOptions.scrollingY&&Math.abs(scrollDeltaX)<Math.abs(scrollDeltaY))||(!_instanceOptions.scrollingX&&_instanceOptions.scrollingY&&Math.abs(scrollDeltaX)>Math.abs(scrollDeltaY)))){return}if(_instanceOptions.invertScrollWheel&&!_instanceOptions.scrollingY&&!scrollDeltaX){scrollDeltaX=scrollDeltaY;scrollDeltaY=0}_cumulativeScroll.x=Math.round(_cumulativeScroll.x+scrollDeltaX);_cumulativeScroll.y=Math.round(_cumulativeScroll.y+scrollDeltaY);_updateScroll(_gestureStart.x+_cumulativeScroll.x,_gestureStart.y+_cumulativeScroll.y,event.timeStamp,event);if(_scrollWheelEndDebouncer){clearTimeout(_scrollWheelEndDebouncer)}_scrollWheelEndDebouncer=setTimeout(function(){_releaseInputCapture();_inputIdentifier=false;_isScrolling=false;_preventClick=false;_isDisplayingScroll=false;_ftscrollerMoving=false;if(_instanceOptions.windowScrollingActiveFlag){window[_instanceOptions.windowScrollingActiveFlag]=false}_cancelAnimation();if(!_snapScroll()){_finalizeScroll()}},300)};_captureInput=function _captureInput(){if(_inputCaptured||_inputIdentifier===false||_inputIdentifier==='scrollwheel'){return}if(_trackPointerEvents){_containerNode[_setPointerCapture](_inputIdentifier);_containerNode.addEventListener(_lostPointerCapture,_onPointerCaptureEnd,false)}_inputCaptured=true};_releaseInputCapture=function _releaseInputCapture(){if(!_inputCaptured){return}if(_trackPointerEvents){_containerNode.removeEventListener(_lostPointerCapture,_onPointerCaptureEnd,false);_containerNode[_releasePointerCapture](_inputIdentifier)}_inputCaptured=false};_getBoundingRect=function _getBoundingRect(anElement){if(anElement.getBoundingClientRect){return anElement.getBoundingClientRect()}var x=0,y=0,eachElement=anElement;while(eachElement){x=x+eachElement.offsetLeft-eachElement.scrollLeft;y=y+eachElement.offsetTop-eachElement.scrollTop;eachElement=eachElement.offsetParent}return{left:x,top:y,width:anElement.offsetWidth,height:anElement.offsetHeight}};_initializeDOM();_updateDimensions();_addEventHandlers();_publicSelf={destroy:destroy,setSnapSize:setSnapSize,scrollTo:scrollTo,scrollBy:scrollBy,updateDimensions:updateDimensions,addEventListener:addEventListener,removeEventListener:removeEventListener,setDisabledInputMethods:setDisabledInputMethods};if(Object.defineProperties){Object.defineProperties(_publicSelf,{'scrollHeight':{get:function(){return _metrics.content.y},set:function(value){throw new SyntaxError('scrollHeight is currently read-only - ignoring '+value);}},'scrollLeft':{get:function(){return-_lastScrollPosition.x},set:function(value){scrollTo(value,false,false);return-_lastScrollPosition.x}},'scrollTop':{get:function(){return-_lastScrollPosition.y},set:function(value){scrollTo(false,value,false);return-_lastScrollPosition.y}},'scrollWidth':{get:function(){return _metrics.content.x},set:function(value){throw new SyntaxError('scrollWidth is currently read-only - ignoring '+value);}},'segmentCount':{get:function(){if(!_instanceOptions.snapping){return{x:NaN,y:NaN}}return{x:Math.ceil(_metrics.content.x/_snapGridSize.x),y:Math.ceil(_metrics.content.y/_snapGridSize.y)}},set:function(value){throw new SyntaxError('segmentCount is currently read-only - ignoring '+value);}},'currentSegment':{get:function(){return{x:_activeSegment.x,y:_activeSegment.y}},set:function(value){throw new SyntaxError('currentSegment is currently read-only - ignoring '+value);}},'contentContainerNode':{get:function(){return _contentParentNode},set:function(value){throw new SyntaxError('contentContainerNode is currently read-only - ignoring '+value);}}})}return _publicSelf};FTScroller.prototype.getPrependedHTML=function(excludeXAxis,excludeYAxis,hwAccelerationClass){if(!hwAccelerationClass){if(typeof FTScrollerOptions==='object'&&FTScrollerOptions.hwAccelerationClass){hwAccelerationClass=FTScrollerOptions.hwAccelerationClass}else{hwAccelerationClass='ftscroller_hwaccelerated'}}var output='<div class="ftscroller_container">';if(!excludeXAxis){output+='<div class="ftscroller_x '+hwAccelerationClass+'">'}if(!excludeYAxis){output+='<div class="ftscroller_y '+hwAccelerationClass+'">'}return output};FTScroller.prototype.getAppendedHTML=function(excludeXAxis,excludeYAxis,hwAccelerationClass,scrollbars){if(!hwAccelerationClass){if(typeof FTScrollerOptions==='object'&&FTScrollerOptions.hwAccelerationClass){hwAccelerationClass=FTScrollerOptions.hwAccelerationClass}else{hwAccelerationClass='ftscroller_hwaccelerated'}}var output='';if(!excludeXAxis){output+='</div>'}if(!excludeYAxis){output+='</div>'}if(scrollbars){if(!excludeXAxis){output+='<div class="ftscroller_scrollbar ftscroller_scrollbarx '+hwAccelerationClass+'"><div class="ftscroller_scrollbarinner"></div></div>'}if(!excludeYAxis){output+='<div class="ftscroller_scrollbar ftscroller_scrollbary '+hwAccelerationClass+'"><div class="ftscroller_scrollbarinner"></div></div>'}}output+='</div>';return output}}());(function(){'use strict';function clamp(value){if(value>1.0)return 1.0;if(value<0.0)return 0.0;return value}CubicBezier=function(p1x,p1y,p2x,p2y){this._p1={x:clamp(p1x),y:clamp(p1y)};this._p2={x:clamp(p2x),y:clamp(p2y)}};CubicBezier.prototype._getCoordinateForT=function(t,p1,p2){var c=3*p1,b=3*(p2-p1)-c,a=1-c-b;return((a*t+b)*t+c)*t};CubicBezier.prototype._getCoordinateDerivateForT=function(t,p1,p2){var c=3*p1,b=3*(p2-p1)-c,a=1-c-b;return(3*a*t+2*b)*t+c};CubicBezier.prototype._getTForCoordinate=function(c,p1,p2,epsilon){if(!isFinite(epsilon)||epsilon<=0){throw new RangeError('"epsilon" must be a number greater than 0.');}var t2,i,c2,d2;for(t2=c,i=0;i<8;i=i+1){c2=this._getCoordinateForT(t2,p1,p2)-c;if(Math.abs(c2)<epsilon){return t2}d2=this._getCoordinateDerivateForT(t2,p1,p2);if(Math.abs(d2)<1e-6){break}t2=t2-c2/d2}t2=c;var t0=0,t1=1;if(t2<t0){return t0}if(t2>t1){return t1}while(t0<t1){c2=this._getCoordinateForT(t2,p1,p2);if(Math.abs(c2-c)<epsilon){return t2}if(c>c2){t0=t2}else{t1=t2}t2=(t1-t0)*0.5+t0}return t2};CubicBezier.prototype.getPointForT=function(t){if(t===0||t===1){return{x:t,y:t}}if(t<0||t>1){_throwRangeError('t',t);}return{x:this._getCoordinateForT(t,this._p1.x,this._p2.x),y:this._getCoordinateForT(t,this._p1.y,this._p2.y)}};CubicBezier.prototype.getTForX=function(x,epsilon){return this._getTForCoordinate(x,this._p1.x,this._p2.x,epsilon)};CubicBezier.prototype.getTForY=function(y,epsilon){return this._getTForCoordinate(y,this._p1.y,this._p2.y,epsilon)};CubicBezier.prototype._getAuxPoints=function(t){if(t<=0||t>=1){_throwRangeError('t',t);}var i0={x:t*this._p1.x,y:t*this._p1.y},i1={x:this._p1.x+t*(this._p2.x-this._p1.x),y:this._p1.y+t*(this._p2.y-this._p1.y)},i2={x:this._p2.x+t*(1-this._p2.x),y:this._p2.y+t*(1-this._p2.y)};var j0={x:i0.x+t*(i1.x-i0.x),y:i0.y+t*(i1.y-i0.y)},j1={x:i1.x+t*(i2.x-i1.x),y:i1.y+t*(i2.y-i1.y)};var k={x:j0.x+t*(j1.x-j0.x),y:j0.y+t*(j1.y-j0.y)};return{i0:i0,i1:i1,i2:i2,j0:j0,j1:j1,k:k}};CubicBezier.prototype.divideAtT=function(t){if(t<0||t>1){_throwRangeError('t',t);}if(t===0||t===1){var curves=[];curves[t]=CubicBezier.linear();curves[1-t]=this.clone();return curves}var left={},right={},points=this._getAuxPoints(t);var i0=points.i0,i2=points.i2,j0=points.j0,j1=points.j1,k=points.k;var factorX=k.x,factorY=k.y;left.p1={x:i0.x/factorX,y:i0.y/factorY};left.p2={x:j0.x/factorX,y:j0.y/factorY};right.p1={x:(j1.x-factorX)/(1-factorX),y:(j1.y-factorY)/(1-factorY)};right.p2={x:(i2.x-factorX)/(1-factorX),y:(i2.y-factorY)/(1-factorY)};return[new CubicBezier(left.p1.x,left.p1.y,left.p2.x,left.p2.y),new CubicBezier(right.p1.x,right.p1.y,right.p2.x,right.p2.y)]};CubicBezier.prototype.divideAtX=function(x,epsilon){if(x<0||x>1){_throwRangeError('x',x);}var t=this.getTForX(x,epsilon);return this.divideAtT(t)};CubicBezier.prototype.divideAtY=function(y,epsilon){if(y<0||y>1){_throwRangeError('y',y);}var t=this.getTForY(y,epsilon);return this.divideAtT(t)};CubicBezier.prototype.clone=function(){return new CubicBezier(this._p1.x,this._p1.y,this._p2.x,this._p2.y)};CubicBezier.prototype.toString=function(){return"cubic-bezier("+[this._p1.x,this._p1.y,this._p2.x,this._p2.y].join(", ")+")"};CubicBezier.linear=function(){return new CubicBezier()};CubicBezier.ease=function(){return new CubicBezier(0.25,0.1,0.25,1.0)};CubicBezier.linear=function(){return new CubicBezier(0.0,0.0,1.0,1.0)};CubicBezier.easeIn=function(){return new CubicBezier(0.42,0,1.0,1.0)};CubicBezier.easeOut=function(){return new CubicBezier(0,0,0.58,1.0)};CubicBezier.easeInOut=function(){return new CubicBezier(0.42,0,0.58,1.0)}}());if(typeof define!=='undefined'&&define.amd){define(function(){'use strict';return{FTScroller:FTScroller,CubicBezier:CubicBezier}})}else if(typeof module!=='undefined'&&module.exports){module.exports=function(domNode,options){'use strict';return new FTScroller(domNode,options)};module.exports.FTScroller=FTScroller;module.exports.CubicBezier=CubicBezier}